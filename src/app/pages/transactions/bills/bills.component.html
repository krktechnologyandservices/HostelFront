<!-- bills.component.html -->
<header class="app-header">
  <div class="header-content">
    <h4>Hostel Management - Bills</h4>
  </div>
</header>

<nb-card class="bills-management-card">
  <nb-card-header class="bills-header">
    <div class="header-content">
      <h4>Bills</h4>
      <input 
        nbInput 
        placeholder="Search by Student, Phone, Room, Status"
        [(ngModel)]="searchTerm"
        (ngModelChange)="applyFilter()"
        class="search-input">
    </div>
  </nb-card-header>

  <nb-card-body class="bills-body" *ngIf="!loading; else loadingTpl">
    
    <!-- Desktop Table -->
    <div class="table-container desktop-view">
      <table class="bills-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Student Name</th>
            <th>Phone</th>
            <th>Room</th>
            <th>Period</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Due Date</th>
            <th class="actions-header">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bill of filteredBills">
            <td>
              <div class="bill-id">#{{ bill.id }}</div>
            </td>
            <td>
              <div class="student-info">
                <nb-icon icon="person-outline" status="info"></nb-icon>
                {{ bill.studentName }}
              </div>
            </td>
            <td>
              <div class="phone-info">
                <nb-icon icon="phone-outline" status="basic"></nb-icon>
                {{ bill.phone }}
              </div>
            </td>
            <td>
              <div class="room-info">
                <nb-icon icon="home-outline" status="primary"></nb-icon>
                {{ bill.roomType }}
              </div>
            </td>
            <td>{{ bill.period }}</td>
            <td>
              <div class="amount-badge">
                {{ bill.amount | currency:'INR' }}
              </div>
            </td>
            <td>
              <div class="status-badge" [class]="'status-' + bill.status?.toLowerCase()">
                {{ bill.status }}
              </div>
            </td>
            <td>
              <div class="due-date">
                {{ bill.dueDate | date:'dd-MMM-yyyy' }}
              </div>
            </td>
            <td class="actions-cell">
              <div class="action-buttons">
                <button 
                  nbButton 
                  status="info" 
                  size="tiny" 
                  (click)="uploadOffline(bill)" 
                  *ngIf="isPending(bill) && 1==2"
                  class="action-btn">
                  <nb-icon icon="upload-outline"></nb-icon>
                  <span class="btn-text">Upload</span>
                </button>
                <button 
                  nbButton 
                  status="primary" 
                  size="tiny" 
                  (click)="approvePayment(bill)" 
                  *ngIf="bill.status.toLowerCase() === 'pending' && bill.paymentMode"
                  class="action-btn">
                  <nb-icon icon="checkmark-outline"></nb-icon>
                  <span class="btn-text">Approve</span>
                </button>
                <button 
                  nbButton 
                  status="danger" 
                  size="tiny" 
                  (click)="rejectPayment(bill)" 
                  *ngIf="bill.status.toLowerCase() === 'pending' && bill.paymentMode"
                  class="action-btn">
                  <nb-icon icon="close-outline"></nb-icon>
                  <span class="btn-text">Reject</span>
                </button>
                <button 
                  nbButton 
                  status="danger" 
                  size="tiny" 
                  (click)="deleteBill(bill)" 
                  *ngIf="bill.status.toLowerCase() !== 'cancelled'"
                  class="action-btn">
                  <nb-icon icon="trash-2-outline"></nb-icon>
                  <span class="btn-text">Cancel</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Mobile Cards -->
    <div class="mobile-view">
      <nb-card *ngFor="let bill of filteredBills" class="bill-card">
        <nb-card-body>
          <div class="bill-card-header">
            <div class="bill-title">
              <nb-icon icon="file-text-outline" status="primary"></nb-icon>
              <div class="title-content">
                <h5>Bill #{{ bill.id }}</h5>
                <span class="student-name">{{ bill.studentName }}</span>
              </div>
            </div>
            <div class="bill-status">
              <div class="status-badge" [class]="'status-' + bill.status?.toLowerCase()">
                {{ bill.status }}
              </div>
            </div>
          </div>
          
          <div class="bill-details">
            <div class="detail-row">
              <div class="detail-item">
                <span class="label">Phone:</span>
                <span class="value">
                  <nb-icon icon="phone-outline"></nb-icon>
                  {{ bill.phone }}
                </span>
              </div>
              <div class="detail-item">
                <span class="label">Room:</span>
                <span class="value">
                  <nb-icon icon="home-outline"></nb-icon>
                  {{ bill.roomType }}
                </span>
              </div>
            </div>
            
            <div class="detail-row">
              <div class="detail-item">
                <span class="label">Period:</span>
                <span class="value">{{ bill.period }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Amount:</span>
                <span class="value amount">{{ bill.amount | currency:'INR' }}</span>
              </div>
            </div>

            <div class="detail-item full-width">
              <span class="label">Due Date:</span>
              <span class="value due-date">
                <nb-icon icon="calendar-outline"></nb-icon>
                {{ bill.dueDate | date:'dd-MMM-yyyy' }}
              </span>
            </div>
          </div>

          <div class="card-actions">
            <button 
              nbButton 
              status="info" 
              size="small" 
              (click)="uploadOffline(bill)" 
              *ngIf="isPending(bill) && 1==2"
              class="action-btn">
              <nb-icon icon="upload-outline"></nb-icon>
              Upload Payment
            </button>
            <button 
              nbButton 
              status="primary" 
              size="small" 
              (click)="approvePayment(bill)" 
              *ngIf="bill.status.toLowerCase() === 'pending' && bill.paymentMode"
              class="action-btn">
              <nb-icon icon="checkmark-outline"></nb-icon>
              Approve
            </button>
            <button 
              nbButton 
              status="danger" 
              size="small" 
              (click)="rejectPayment(bill)" 
              *ngIf="bill.status.toLowerCase() === 'pending' && bill.paymentMode"
              class="action-btn">
              <nb-icon icon="close-outline"></nb-icon>
              Reject
            </button>
            <button 
              nbButton 
              status="danger" 
              size="small" 
              (click)="deleteBill(bill)" 
              *ngIf="bill.status.toLowerCase() !== 'cancelled'"
              class="action-btn">
              <nb-icon icon="trash-2-outline"></nb-icon>
              Cancel
            </button>
          </div>
        </nb-card-body>
      </nb-card>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredBills.length === 0" class="empty-state">
      <nb-icon icon="file-text-outline" status="basic" class="empty-icon"></nb-icon>
      <h4>No bills found</h4>
      <p *ngIf="searchTerm">Try adjusting your search criteria</p>
    </div>
  </nb-card-body>
</nb-card>

<ng-template #loadingTpl>
  <div class="loading-container">
    <nb-spinner size="giant"></nb-spinner>
    <p>Loading bills...</p>
  </div>
</ng-template>