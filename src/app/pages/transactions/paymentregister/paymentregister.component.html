<form [formGroup]="filterForm" (ngSubmit)="submitFilter()">
  <nb-card>
    <nb-card-header class="fw-bold">Filters</nb-card-header>
    <nb-card-body>
      <div class="row g-2">
        <div class="col-6 col-md-3">
          <label class="fw-bold">Rooms</label>
          <nb-select placeholder="Select Rooms" formControlName="rooms" multiple fullWidth>
            <nb-option *ngFor="let room of rooms" [value]="room.Id">{{ room.Name }}</nb-option>
          </nb-select>
        </div>

        <div class="col-6 col-md-3">
          <label class="fw-bold">Students</label>
          <nb-select placeholder="Select Students" formControlName="students" multiple fullWidth>
            <nb-option *ngFor="let student of students" [value]="student.Id">{{ student.FullName }}</nb-option>
          </nb-select>
        </div>

        <div class="col-6 col-md-3">
          <label class="fw-bold">From Date</label>
          <input nbInput type="date" formControlName="fromDate" fullWidth>
        </div>

        <div class="col-6 col-md-3">
          <label class="fw-bold">To Date</label>
          <input nbInput type="date" formControlName="toDate" fullWidth>
        </div>
      </div>

      <button nbButton status="primary" type="submit" class="mt-3">Apply Filters</button>
      <button nbButton status="success" type="button" class="mt-3 ms-2" (click)="exportPDF()">Export PDF</button>
    </nb-card-body>
  </nb-card>
</form>

<!-- Desktop Table -->
<div class="payment-table d-none d-md-block mt-3">
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th class="fw-bold">Date</th>
        <th class="fw-bold">Student</th>
        <th class="fw-bold">Room</th>
        <th class="fw-bold">Payment Type</th>
        <th class="fw-bold">Payment Mode</th>
        <th class="fw-bold text-end">Amount</th>
        <th class="fw-bold">Status</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pay of payments">
        <td>{{ pay.paymentDate | date:'shortDate' }}</td>
        <td>{{ pay.studentName }}</td>
        <td>{{ pay.roomNo }}</td>
        <td>{{ pay.paymentType }}</td>
        <td>{{ pay.paymentMode }}</td>
        <td class="text-end">{{ pay.paymentAmount | number:'1.2-2' }}</td>
        <td [ngClass]="getStatusClass(pay.paymentStatus)">
          {{ pay.paymentStatus }}
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Mobile Cards -->
<div class="payment-cards d-md-none mt-3">
  <nb-card *ngFor="let pay of payments" class="mb-2">
    <nb-card-body>
      <div class="fw-bold">{{ pay.studentName }} - {{ pay.roomNo }}</div>
      <div>{{ pay.paymentDate | date:'shortDate' }} | {{ pay.paymentType }} | {{ pay.paymentMode }}</div>
      <div class="text-end fw-bold">
        Amount: {{ pay.paymentAmount | number:'1.2-2' }}
        (<span [ngClass]="getStatusClass(pay.paymentStatus)">{{ pay.paymentStatus }}</span>)
      </div>

      <div *ngIf="pay.roomRents?.length">
        <div class="mt-2 fw-bold">Room Rent Paid</div>
        <div *ngFor="let r of pay.roomRents" class="d-flex justify-content-between">
          <span>{{r.Month}} (Bill {{r.BillNo}})</span>
          <span>{{r.Amount | number:'1.2-2'}}</span>
        </div>
      </div>

      <div *ngIf="pay.otherCharges?.length">
        <div class="mt-2 fw-bold">Other Charges</div>
        <div *ngFor="let c of pay.otherCharges" class="d-flex justify-content-between">
          <span>{{c.particulars}}</span>
          <span>{{c.amount | number:'1.2-2'}}</span>
        </div>
      </div>

      <div *ngIf="pay.advances?.length">
        <div class="mt-2 fw-bold">Advance Paid</div>
        <div *ngFor="let a of pay.advances" class="d-flex justify-content-between">
          <span>{{ a.createdAt | date:'shortDate' }}</span>
          <span>{{ a.amount | number:'1.2-2'}}</span>
        </div>
      </div>
    </nb-card-body>
  </nb-card>
</div>
