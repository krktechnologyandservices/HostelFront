<!-- payments.component.html -->
<nb-card class="payment-management-card">
  <nb-card-header class="payment-header">
    <div class="header-content">
      <h4>Payments</h4>
      <button nbButton status="primary" size="small" (click)="addPayment()">
        <nb-icon icon="plus-outline"></nb-icon>
        Add Payment
      </button>
    </div>
  </nb-card-header>

  <nb-card-body class="payment-body">
    <!-- Filter Section -->
    <div class="filter-section">
      <div class="filter-input-group">
        <input 
          nbInput 
          fullWidth 
          placeholder="Search by Name or Receipt No" 
          [(ngModel)]="searchText" 
          (input)="applyFilter()"
          class="search-input">
        <div class="date-filters">
          <input 
            nbInput 
            type="date" 
            [(ngModel)]="fromDate" 
            (change)="applyFilter()"
            class="date-input">
          <input 
            nbInput 
            type="date" 
            [(ngModel)]="toDate" 
            (change)="applyFilter()"
            class="date-input">
        </div>
        <div class="filter-buttons">
          <button nbButton status="success" size="small" (click)="submitFilter()" class="filter-btn">
            <nb-icon icon="search-outline"></nb-icon>
            Search
          </button>
          <button nbButton status="basic" size="small" (click)="resetFilter()" class="filter-btn">
            <nb-icon icon="refresh-outline"></nb-icon>
            Reset
          </button>
        </div>
      </div>
    </div>

    <nb-spinner *ngIf="loading" class="loading-spinner"></nb-spinner>

    <!-- Desktop Table -->
    <div class="table-container desktop-view" *ngIf="!loading && filteredPayments.length">
      <table class="payments-table">
        <thead>
          <tr>
            <th>Receipt No</th>
            <th>Student Name</th>
            <th>Payment Date</th>
            <th>Payment Mode</th>
            <th>Amount</th>
            <th>Payment Type</th>
            <th>Status</th>
            <th class="actions-header">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of filteredPayments">
            <td>
              <div class="receipt-number">#{{ p.id }}</div>
            </td>
            <td>
              <div class="student-info">
                <nb-icon icon="person-outline" status="info"></nb-icon>
                {{ p.studentName }}
              </div>
            </td>
            <td>
              <div class="payment-date">
                {{ p.paymentDate | date:'mediumDate' }}
              </div>
            </td>
            <td>{{ p.paymentMode }}</td>
            <td>
              <div class="amount-badge">
                {{ p.amount | currency:'INR' }}
              </div>
            </td>
            <td>{{ p.paymentType }}</td>
            <td>
              <div class="status-badge" [class]="'status-' + p.status?.toLowerCase()">
                {{ p.status }}
              </div>
            </td>
            <td class="actions-cell">
              <div class="action-buttons">
                <button 
                  nbButton 
                  status="info" 
                  size="tiny" 
                  (click)="editPayment(p)" 
                  *ngIf="1==2"
                  class="action-btn">
                  <nb-icon icon="edit-2-outline"></nb-icon>
                  <span class="btn-text">Edit</span>
                </button>
                <button 
                  nbButton 
                  status="danger" 
                  size="tiny" 
                  (click)="deletePayment(p)" 
                  *ngIf="p.status != 'Cancelled'"
                  class="action-btn">
                  <nb-icon icon="close-outline"></nb-icon>
                  <span class="btn-text">Cancel</span>
                </button>
                <button 
                  nbButton 
                  status="primary" 
                  size="tiny" 
                  (click)="printReceipt(p)" 
                  *ngIf="p.status == 'Paid'"
                  class="action-btn">
                  <nb-icon icon="printer-outline"></nb-icon>
                  <span class="btn-text">Print</span>
                </button>
                <button 
                  nbButton 
                  status="success" 
                  size="tiny" 
                  (click)="UpdateVerficaition(p.id)" 
                  *ngIf="p.status == 'Verification'"
                  class="action-btn">
                  <nb-icon icon="checkmark-outline"></nb-icon>
                  <span class="btn-text">Verify</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Mobile Cards -->
    <div class="mobile-view" *ngIf="!loading && filteredPayments.length">
      <nb-card *ngFor="let p of filteredPayments" class="payment-card">
        <nb-card-body>
          <div class="payment-card-header">
            <div class="payment-title">
              <nb-icon icon="credit-card-outline" status="primary"></nb-icon>
              <div class="title-content">
                <h5>Receipt #{{ p.id }}</h5>
                <span class="student-name">{{ p.studentName }}</span>
              </div>
            </div>
            <div class="payment-status">
              <div class="status-badge" [class]="'status-' + p.status?.toLowerCase()">
                {{ p.status }}
              </div>
            </div>
          </div>
          
          <div class="payment-details">
            <div class="detail-row">
              <div class="detail-item">
                <span class="label">Payment Date:</span>
                <span class="value">
                  <nb-icon icon="calendar-outline"></nb-icon>
                  {{ p.paymentDate | date:'mediumDate' }}
                </span>
              </div>
              <div class="detail-item">
                <span class="label">Amount:</span>
                <span class="value amount">{{ p.amount | currency:'INR' }}</span>
              </div>
            </div>
            
            <div class="detail-row">
              <div class="detail-item">
                <span class="label">Payment Mode:</span>
                <span class="value">{{ p.paymentMode }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Payment Type:</span>
                <span class="value">{{ p.paymentType }}</span>
              </div>
            </div>
          </div>

          <div class="card-actions">
            <button 
              nbButton 
              status="info" 
              size="small" 
              (click)="editPayment(p)" 
              *ngIf="1==2"
              class="action-btn">
              <nb-icon icon="edit-2-outline"></nb-icon>
              Edit
            </button>
            <button 
              nbButton 
              status="danger" 
              size="small" 
              (click)="deletePayment(p)" 
              *ngIf="p.status != 'Cancelled'"
              class="action-btn">
              <nb-icon icon="close-outline"></nb-icon>
              Cancel
            </button>
            <button 
              nbButton 
              status="primary" 
              size="small" 
              (click)="printReceipt(p)" 
              *ngIf="p.status == 'Paid'"
              class="action-btn">
              <nb-icon icon="printer-outline"></nb-icon>
              Print
            </button>
            <button 
              nbButton 
              status="success" 
              size="small" 
              (click)="UpdateVerficaition(p.id)" 
              *ngIf="p.status == 'Verification'"
              class="action-btn">
              <nb-icon icon="checkmark-outline"></nb-icon>
              Verify
            </button>
          </div>
        </nb-card-body>
      </nb-card>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !filteredPayments.length" class="empty-state">
      <nb-icon icon="credit-card-outline" status="basic" class="empty-icon"></nb-icon>
      <h4>No payments found</h4>
      <p *ngIf="searchText || fromDate || toDate">Try adjusting your search criteria</p>
      <button 
        nbButton 
        status="primary" 
        (click)="addPayment()"
        *ngIf="payments.length === 0">
        Create Your First Payment
      </button>
    </div>
  </nb-card-body>
</nb-card>