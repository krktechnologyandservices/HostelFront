<nb-card>
  <!-- Header with Add Button -->
  <nb-card-header class="header-section">
    <span>Students</span>
    <button nbButton status="success" size="small" (click)="router.navigate(['pages/master/students/add'])" class="add-button">
      Add Student
    </button>
  </nb-card-header>

  <nb-card-body>
    <!-- Search Section -->
    <div class="search-section">
      <input nbInput placeholder="Search by name, email, phone" [(ngModel)]="searchQuery" class="search-input">
      <div class="search-buttons">
        <button nbButton status="info" size="tiny" (click)="search()">Search</button>
        <button nbButton status="secondary" size="tiny" (click)="clearSearch()">Reset</button>
      </div>
    </div>

    <!-- Students List -->
    <div class="student-cards">
      <div class="student-card" *ngFor="let student of filteredStudents">

        <div class="card-grid">
          <!-- Left Column: Student & Guardian Info -->
          <div class="student-info-col">
            <h4>{{student.fullName}}</h4>
            <div class="info-item"><label>Course Name:</label> <span>{{student.courseName}}</span></div>
            <div class="info-item"><label>Email:</label> <span>{{student.email}}</span></div>
            <div class="info-item"><label>Phone:</label> <span>{{student.phone}}</span></div>
            <div class="info-item"><label>DOB:</label> <span>{{student.dob | date:'shortDate'}}</span></div>
            <div class="info-item"><label>Guardian:</label> <span>{{student.guardianName}}</span></div>
            <div class="info-item"><label>Guardian Phone:</label> <span>{{student.guardianPhone}}</span></div>
            <div class="info-item"><label>Guardian Alt:</label> <span>{{student.guardianAlternativeMobile}}</span></div>

            <!-- Action Buttons -->
            <div class="card-actions">
              <button nbButton status="primary" size="tiny" (click)="edit(student)">Edit</button>
              <button nbButton status="danger" size="tiny" (click)="delete(student)">Delete</button>
              <button nbButton status="info" size="tiny" (click)="viewStudent(student)">View</button>
            </div>

            <!-- Photo Upload Section (visible on view) -->
            <div *ngIf="viewingStudent?.studentId === student.studentId" class="photo-actions">
              <input type="file" (change)="onPhotoSelected($event, student)" accept="image/*" />
              <button *ngIf="selectedPhotos[student.studentId!]" nbButton status="info" size="tiny" (click)="uploadPhoto(student)">Upload</button>
              <button *ngIf="student.photoUrl" nbButton status="danger" size="tiny" (click)="removePhoto(student)">Remove</button>
            </div>
          </div>

          <!-- Right Column: Fixed Square Photo -->
          <div class="student-photo-col">
            <div class="photo-frame" (click)="enlargePhoto(student.photoUrl)" [title]="'Click to enlarge'">
              <img *ngIf="student.photoUrl; else noPhoto" [src]="student.photoUrl" class="student-photo">
              <ng-template #noPhoto>
                <div class="photo-placeholder">No Photo</div>
              </ng-template>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredStudents.length === 0" class="no-data">
      <h3>No students found</h3>
      <p *ngIf="searchQuery">Try adjusting your search criteria</p>
    </div>

  </nb-card-body>
</nb-card>

<!-- Optional: Modal or Lightbox for Enlarged Photo -->
<nb-dialog *ngIf="enlargedPhotoUrl" (close)="enlargedPhotoUrl = null">
  <img [src]="enlargedPhotoUrl" style="width:100%; max-width:400px; border-radius:8px;" />
</nb-dialog>
