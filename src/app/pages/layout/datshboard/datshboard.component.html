<nb-layout>
    <nb-layout-column>
  
      <!-- KPI Cards -->
      <div class="row mb-3">
        <nb-card status="primary">
          <nb-card-header>Total Students</nb-card-header>
          <nb-card-body>{{studentStats?.totalStudents}}</nb-card-body>
        </nb-card>
  
        <nb-card status="info">
          <nb-card-header>Active Bookings</nb-card-header>
          <nb-card-body>{{studentStats?.activeBookings}}</nb-card-body>
        </nb-card>
  
        <nb-card status="success">
          <nb-card-header>Vacated Students</nb-card-header>
          <nb-card-body>{{studentStats?.vacatedStudents}}</nb-card-body>
        </nb-card>
  
        <nb-card status="danger">
          <nb-card-header>Total Late Fees</nb-card-header>
          <nb-card-body>{{lateFees?.totalLateFees | currency}}</nb-card-body>
        </nb-card>
      </div>
  
      <!-- Pending Dues Table -->
      <nb-card class="mb-3">
        <nb-card-header>Pending Dues</nb-card-header>
        <nb-card-body>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Student</th>
                  <th>Room</th>
                  <th>Amount</th>
                  <th>Due Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of pendingDues">
                  <td>{{item.studentName}}</td>
                  <td>{{item.roomNumber}}</td>
                  <td>{{item.pendingAmount | currency}}</td>
                  <td>{{item.dueDate | date}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </nb-card-body>
      </nb-card>

  
      <!-- Upcoming Bills Table -->
      <nb-card class="mb-3">
        <nb-card-header class="d-flex justify-content-between align-items-center">
          <span>Upcoming Bills (Next 7 Days)</span>
      
          <!-- Attractive Button -->
          <button nbButton status="success" size="small" (click)="onGenerateBills()" [disabled]="isGenerating" nbTooltip="Generate Bills Now">
            <nb-icon *ngIf="!isGenerating" icon="flash-outline"></nb-icon>
            <span *ngIf="!isGenerating">Generate</span>
      
            <!-- Show spinner when busy -->
            <nb-spinner *ngIf="isGenerating" size="tiny"></nb-spinner>
          </button>
        </nb-card-header>
      
        <nb-card-body>
          <div *ngIf="isGenerating" class="text-center my-3">
            <nb-spinner size="large"></nb-spinner>
            <p class="mt-2">Generating bills, please wait...</p>
          </div>
      
          <div class="table-responsive" *ngIf="!isGenerating">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Student</th>
                  <th>Room</th>
                  <th>Due Date</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let bill of upcomingBills">
                  <td>{{bill.studentName}}</td>
                  <td>{{bill.roomNumber}}</td>
                  <td>{{bill.dueDate | date}}</td>
                  <td>{{bill.totalAmount | currency}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </nb-card-body>
      </nb-card>
      
      
  
      <!-- Room Utilization Table -->
      <nb-card class="mb-3">
        <nb-card-header>Room Utilization</nb-card-header>
        <nb-card-body>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Room</th>
                  <th>Capacity</th>
                  <th>Occupied</th>
                  <th>Available</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let room of roomUtilization">
                  <td>{{room.roomNumber}}</td>
                  <td>{{room.capacity}}</td>
                  <td>{{room.occupiedCount}}</td>
                  <td>{{room.capacity - room.occupiedCount}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </nb-card-body>
      </nb-card>
  
    </nb-layout-column>
  </nb-layout>
  